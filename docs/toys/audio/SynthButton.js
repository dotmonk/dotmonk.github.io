import n,{Component as a}from"../../_snowpack/pkg/react.js";import{Button as d}from"../../_snowpack/pkg/react-nyx-components.js";class r extends a{constructor(e){super(e);this.state={pressed:!1},this.gainNode=e.audioContext.createGain(),this.gainNode.connect(e.audioContext.destination),this.gainNode.gain.setTargetAtTime(1e-6,e.audioContext.currentTime,.06),this.oscillatorNode=e.audioContext.createOscillator(),this.oscillatorNode.connect(this.gainNode),this.oscillatorNode.type=e.waveform,this.oscillatorNode.frequency.value=e.frequency,this.oscillatorNode.start(),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this)}componentWillReceiveProps(e){e.waveform!==this.props.waveform&&(this.gainNode.disconnect(),this.oscillatorNode.disconnect(),this.oscillatorNode.stop(),this.gainNode=e.audioContext.createGain(),this.gainNode.connect(e.audioContext.destination),this.gainNode.gain.setTargetAtTime(1e-6,e.audioContext.currentTime,.06),this.oscillatorNode=e.audioContext.createOscillator(),this.oscillatorNode.connect(this.gainNode),this.oscillatorNode.type=e.waveform,this.oscillatorNode.frequency.value=e.frequency,this.oscillatorNode.start())}onKeyDown(e){const t=e.key,{synthKey:o,audioContext:i}=this.props;t===o&&(this.gainNode.gain.setTargetAtTime(1,i.currentTime,.06),this.setState({pressed:!0}))}onKeyUp(e){const t=e.key,{synthKey:o,audioContext:i}=this.props;t===o&&(this.gainNode.gain.setTargetAtTime(1e-6,i.currentTime,.06),this.setState({pressed:!1}))}componentDidMount(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}componentWillUnmount(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}render(){const{label:e,synthKey:t,raised:o}=this.props,{pressed:i}=this.state,s=Object.assign({borderTopLeftRadius:"0px",borderTopRightRadius:"0px",borderBottomLeftRadius:"3px",borderBottomRightRadius:"3px",fontSize:"8px",width:"20px",padding:"3px",height:"90px",paddingTop:"60px",marginRight:"-3px",position:"relative"},o?{height:"60px",paddingTop:"33px",verticalAlign:"top",marginRight:"-13px",marginLeft:"-7px",zIndex:2}:{});return n.createElement(d,{style:s,color:o?"bright":void 0,active:i,onMouseDown:()=>{window.dispatchEvent(new KeyboardEvent("keydown",{key:t}))},onMouseUp:()=>{window.dispatchEvent(new KeyboardEvent("keyup",{key:t}))}},e,n.createElement("br",null),t)}}export default r;
